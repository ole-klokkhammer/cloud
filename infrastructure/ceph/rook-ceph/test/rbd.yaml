apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: rook-test
  namespace: rook-ceph
  labels:
    app: rook-test
spec:
  replicas: 1
  serviceName: rook-test
  selector:
    matchLabels:
      app: rook-test
  template:
    metadata:
      namespace: rook-ceph
      labels:
        app: rook-test
    spec:
      containers:
        - name: rook-test
          image: nginx 
          volumeMounts:
            - mountPath: /config
              name: rook-test-data
  volumeClaimTemplates:
    - metadata:
        name: rook-test-data
        namespace: rook-ceph
        annotations:
          csi.storage.k8s.io/volume-name: rook-test-data2
      spec:
        storageClassName: ceph-rbd
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 1Gi
        # The volumeMode can be either `Filesystem` or `Block` if you are creating Filesystem PVC it should be `Filesystem`, if you are creating Block PV you need to change it to `Block`
        volumeMode: Filesystem
        # volumeName should be same as PV name
        volumeName: rook-test-data  
---
# https://github.com/ceph/ceph-csi/blob/devel/docs/static-pvc.md

apiVersion: v1
kind: PersistentVolume
metadata:
  name: rook-test-data
  namespace: rook-ceph
spec:
  accessModes:
  - ReadWriteOnce
  capacity:
    storage: 1Gi
  storageClassName: ceph-rbd
  
  persistentVolumeReclaimPolicy: Retain
  volumeMode: Filesystem
  csi:
    driver: rook-ceph.rbd.csi.ceph.com
    fsType: ext4
    # volumeHandle should be same as rbd image name
    volumeHandle: static-image
    volumeAttributes:
      clusterID: rook-ceph
      staticVolume: "true"  
      imageFeatures: layering
      imageFormat: '2' 
      pool: k3s-rbd
    nodeStageSecretRef:
      name: rook-csi-rbd-node
      namespace: rook-ceph